# =========================
# Cross Care Group .htaccess
# =========================

# --- Rewrite engine ---
<IfModule mod_rewrite.c>
  RewriteEngine On

  # 1) Force HTTPS
  RewriteCond %{HTTPS} !=on
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

  # 2) Canonical host (choose ONE: with or without www)
  # If you want NON-www as canonical:
  RewriteCond %{HTTP_HOST} ^www\.crosscaregroup\.com\.au$ [NC]
  RewriteRule ^ https://crosscaregroup.com.au%{REQUEST_URI} [R=301,L]

  # ---- Critical redirects to prevent legacy/WP SEO split ----

  # 3) /resources -> /resources/ (and ensure it hits the new site)
  RewriteRule ^resources$ /resources/ [R=301,L]

  # 4) Legacy WP paths -> new equivalents (EDIT THESE MAPPINGS)
  Redirect 301 /privacy-policy-2/ /legal/privacy-policy/
  Redirect 301 /terms-of-use/ /legal/terms-of-use/
  Redirect 301 /about-us/ /why-cross-care/
  Redirect 301 /our-approach/ /why-cross-care/
  Redirect 301 /complex-care/ /services/complex-care/

  # 5) If there are URLs you want GONE (not replaced), return 410
  # RewriteRule ^old-path-you-removed/?$ - [G,L]

  # 6) If WP endpoints are being probed / still exist, hard-block them
  RewriteRule ^wp-admin/? - [F,L]
  RewriteRule ^wp-login\.php$ - [F,L]
  RewriteRule ^xmlrpc\.php$ - [F,L]
  RewriteRule ^wp-content/ - [F,L]
  RewriteRule ^wp-includes/ - [F,L]
</IfModule>


# --- Security headers ---
<IfModule mod_headers.c>
  Header set Strict-Transport-Security "max-age=31536000; includeSubDomains"
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  # CORS allowlist (your original approach)
  SetEnvIf Origin "^https?://((www\.)?(testing\.)?crosscaregroup\.com\.au|localhost:[0-9]+)$" AccessControlAllowOrigin=$0
  Header set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
  Header merge Vary Origin

  # CSP (keep aligned with your HTML meta CSP)
  Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://*.jotform.com https://*.jotfor.ms https://www.google-analytics.com https://www.googletagmanager.com https://img.youtube.com; frame-src 'self' https://www.youtube.com https://youtube.com https://www.youtube-nocookie.com https://form.jotform.com https://jotform.com https://*.jotform.com https://*.jotfor.ms blob:; connect-src 'self' https://*.powerplatform.com https://*.azure.com https://*.jotform.com https://*.jotfor.ms; object-src 'none'; base-uri 'self'; form-action 'self' https://*.jotform.com; frame-ancestors 'none'; upgrade-insecure-requests;"
</IfModule>


# --- Custom error page ---
ErrorDocument 404 /404.html


# --- Browser caching ---
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType image/x-icon "access plus 1 year"
</IfModule>
